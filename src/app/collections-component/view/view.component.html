<div class="float" appClickOutside (clickOutside)="close()">
  <div class="collection-create">
    <h4 class="text-black text-bold mb-3">
      {{ view.id ? 'Edit View' : 'Create View' }}
    </h4>

    <div class="form">
      <!-- Type First -->
      <div class="group">
        <label for="type">Type</label>
        <select
          id="type"
          [(ngModel)]="view.type"
          (ngModelChange)="onTypeChange()"
          name="type"
          required
          [ngClass]="{ 'is-invalid': !view.type }"
        >
          <option *ngFor="let type of viewTypes" [value]="type.value">
            {{ type.label }}
          </option>
        </select>
      </div>

      <!-- Name Field (after type) -->
      <div class="group">
        <label for="name">Name</label>
        <input
          type="search"
          id="name"
          [(ngModel)]="view.name"
          (input)="nameTouched = true"
          name="name"
          placeholder="View name"
          required
          [ngClass]="{ 'is-invalid': view.name === '' }"
        />
      </div>

      <!-- Report Config -->
      <app-view-config
        *ngIf="view.type && view.type !== 'table'"
        [view]="view"
        [columns]="collection.columns"
      ></app-view-config>

      <!-- Table Column Selector -->
      <div class="group" *ngIf="view.type === 'table'">
        <label class="text-sm font-semibold mb-2 block">Visible Columns</label>
        <div class="flex flex-wrap gap-2">
          <label
            *ngFor="let col of visibleColumns"
            class="flex items-center space-x-2"
          >
            <input
              type="checkbox"
              [checked]="isColumnSelected(col.id)"
              (change)="toggleColumn(col.id)"
            />
            <span>{{ col.name }}</span>
          </label>
        </div>
      </div>

      <!-- Save Button -->
      <div class="pt-1 flex flex-col sm:flex-row justify-end gap-4">
        <button
          (click)="submit()"
          type="submit"
          [disabled]="!view.name || !view.type"
          class="px-6 py-2 rounded-lg bg-[var(--accent)] text-black font-semibold hover:brightness-110 transition disabled:opacity-50 disabled:cursor-not-allowed"
        >
          Save
        </button>
      </div>
    </div>
  </div>
</div>
